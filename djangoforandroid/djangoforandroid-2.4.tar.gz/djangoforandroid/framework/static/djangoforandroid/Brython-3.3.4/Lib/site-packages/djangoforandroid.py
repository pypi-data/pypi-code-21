from browser import ajax, window


########################################################################
class Django:
    """"""

    #----------------------------------------------------------------------
    def __init__(self, url="/brython/", csrftoken=None):
        """Constructor"""

        self.url = url

        if csrftoken:
            self.csrftoken = csrftoken
        else:
            self.csrftoken = window.csrftoken


    #----------------------------------------------------------------------
    def __getattr__(self, attr):
        """"""
        f = lambda *args, **kwargs: self.__request__(attr, *args, **kwargs)
        f.__name__ = attr
        return f


    #----------------------------------------------------------------------
    def __request__(self, attr, *args, **kwargs):
        """"""
        req = ajax.ajax()
        req.open('POST', self.url, False)
        req.set_header('content-type','application/x-www-form-urlencoded')
        req.send({'name': attr, 'args': args, 'kwargs': kwargs, 'csrfmiddlewaretoken': self.csrftoken})
        return eval(req.text)['__D4A__']




